# System Architecture: Scavenger Platform

**Version:** 1.0  
**Last Updated:** February 16, 2026  
**Status:** Pre-Development / Design Phase

---

## Overview

Scavenger is a serverless, mobile-first web application that uses AI-powered vision processing to digitize physical event flyers and display them in a real-time feed. The architecture prioritizes simplicity, speed, and zero-DevOps complexity for rapid MVP iteration.

---

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                     Client (Browser)                        │
│                  Mobile-First React UI                      │
└────────────────────────┬────────────────────────────────────┘
                         │ HTTPS
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                    Vercel Edge Network                      │
│              (Static Hosting + API Routes)                  │
└─────┬───────────────────┬───────────────────┬───────────────┘
      │                   │                   │
      │ Next.js SSR       │ API Routes        │ Static Assets
      ▼                   ▼                   ▼
┌─────────────┐   ┌──────────────┐   ┌────────────────┐
│   Feed UI   │   │  /api/upload │   │   Images/CSS   │
│   Upload UI │   │  /api/posts  │   │   Fonts        │
└─────────────┘   └───────┬──────┘   └────────────────┘
                          │
                          ├─────────────┐
                          │             │
                          ▼             ▼
                  ┌────────────┐  ┌─────────────────┐
                  │  Gemini    │  │   Firestore     │
                  │ 2.0 Flash  │  │   (Database)    │
                  │    API     │  │  - Posts        │
                  └────────────┘  │  - Real-time    │
                                  └─────────────────┘
                                          │
                                          ▼
                                  ┌─────────────────┐
                                  │ Firebase Storage│
                                  │ (Flyer Images)  │
                                  └─────────────────┘
```

---

## Technology Stack

### Frontend
- **Framework:** Next.js 14 (App Router)
- **UI Library:** React 18
- **Styling:** Tailwind CSS
- **State Management:** React Context / useState (simple MVP)
- **HTTP Client:** Native fetch API

**Rationale:**
- Next.js provides SSR for SEO and fast initial loads
- App Router is the modern Next.js pattern
- Tailwind enables rapid mobile-first prototyping
- No complex state management needed for MVP

---

### Backend
- **Runtime:** Node.js 18+ (Vercel serverless functions)
- **API Framework:** Next.js API Routes
- **Authentication:** None (MVP) — future: Firebase Auth
- **File Upload:** Multipart form data via API route

**Rationale:**
- Next.js API routes = no separate backend needed
- Serverless = zero infrastructure management
- Simple REST endpoints for MVP

---

### Database
- **Primary:** Firestore (Firebase)
- **Schema:** Document-based (NoSQL)
- **Real-time:** Built-in WebSocket support

**Rationale:**
- Real-time updates without custom WebSocket logic
- Generous free tier (50k reads/day, 20k writes/day)
- Easy to query and scale
- Built-in offline support (future mobile app)

---

### AI/ML
- **Provider:** Google Generative AI (Gemini 2.0 Flash)
- **Endpoint:** REST API via `@google/generative-ai` SDK
- **Use Case:** Multimodal vision (flyer image → structured JSON)

**Rationale:**
- 30x cheaper than GPT-4o (~$0.000075 per image)
- 6x faster (2.24s vs 13s latency)
- Superior OCR accuracy (WER 0.24 vs 0.51)
- Native support for image + text prompts

---

### Storage
- **Images:** Firebase Storage
- **CDN:** Automatic via Firebase

**Rationale:**
- Integrated with Firestore
- Automatic image optimization
- Free tier: 5GB storage, 1GB/day download

---

### Hosting & Deployment
- **Platform:** Vercel
- **CI/CD:** GitHub integration (auto-deploy on push to `main`)
- **Domain:** TBD (vercel.app subdomain for MVP)

**Rationale:**
- Zero-config deployment
- Free tier: Unlimited bandwidth for non-commercial
- Edge network for global low latency
- Preview deployments for PRs

---

## Data Models

### Post (Firestore Document)

```typescript
interface Post {
  id: string;                    // Auto-generated by Firestore
  createdAt: Timestamp;          // Server timestamp
  updatedAt: Timestamp;          // For status changes
  
  // Event Details
  eventName: string;             // "CS Club Pizza Social"
  location: {
    building: string;            // "TMCB"
    room: string;                // "210"
  };
  dateTime: {
    start: Timestamp;            // Event start time
    end: Timestamp;              // Event end time
  };
  
  // Food Details
  foodDescription: string;       // "3 large pizzas (pepperoni, cheese, veggie)"
  estimatedPortions?: number;    // Optional: 20
  dietaryInfo?: string[];        // Optional: ["vegetarian", "gluten-free"]
  
  // Metadata
  status: "available" | "gone";  // Status tracking
  imageUrl?: string;             // Firebase Storage URL
  uploaderEditKey: string;       // UUID for edit access (no auth)
  source: "flyer_photo" | "manual" | "slack" | "email"; // Ingestion source
  
  // Analytics (optional)
  viewCount?: number;            // How many people viewed this
  claimCount?: number;           // How many "claimed" (future feature)
}
```

### Firestore Collection Structure

```
/posts
  /{postId}
    - All fields from Post interface
    - Auto-indexing on: createdAt, dateTime.start, status
```

**Indexes:**
- Composite index: `status == "available" AND dateTime.start ASC`
- Used for: "Show me all available events sorted by soonest first"

---

## API Endpoints

### POST `/api/upload`
**Purpose:** Upload flyer image, extract data via Gemini, return structured JSON

**Request:**
```typescript
// Multipart form data
{
  image: File;  // JPEG/PNG, max 10MB
}
```

**Response:**
```typescript
{
  success: true,
  extractedData: {
    eventName: string;
    location: { building: string; room: string };
    dateTime: { start: string; end: string }; // ISO format
    foodDescription: string;
    estimatedPortions?: number;
  },
  confidence: number; // 0-1, AI confidence score (future)
}
```

**Error Handling:**
- 400: Invalid image format
- 413: File too large
- 500: Gemini API error

---

### POST `/api/posts`
**Purpose:** Create a new post after user confirms AI extraction

**Request:**
```typescript
{
  eventName: string;
  location: { building: string; room: string };
  dateTime: { start: string; end: string };
  foodDescription: string;
  estimatedPortions?: number;
  imageUrl?: string; // Firebase Storage URL (uploaded separately)
}
```

**Response:**
```typescript
{
  success: true,
  postId: string;
  editKey: string; // UUID for later editing (no auth)
  editUrl: string; // Direct link to edit/delete
}
```

---

### GET `/api/posts`
**Purpose:** Fetch all available posts (feed data)

**Query Params:**
- `status` (optional): "available" | "gone" (default: "available")
- `limit` (optional): number (default: 50)
- `startAfter` (optional): timestamp (for pagination)

**Response:**
```typescript
{
  success: true,
  posts: Post[];
  hasMore: boolean;
}
```

---

### PATCH `/api/posts/:postId`
**Purpose:** Update post status (mark as "gone")

**Request:**
```typescript
{
  editKey: string;     // Required for authorization
  status: "gone";      // Only allowed status change in MVP
}
```

**Response:**
```typescript
{
  success: true,
  message: "Post marked as gone"
}
```

---

## Security Considerations

### MVP (Phase 1)
- ✅ No user accounts = no password leaks
- ✅ Rate limiting on API routes (5 uploads/IP/hour)
- ✅ Image file validation (type, size, dimensions)
- ✅ Firestore security rules (read: public, write: API only)
- ✅ Edit keys are UUIDs (hard to guess)
- ⚠️ No CAPTCHA (accept spam risk for MVP simplicity)

### Phase 2 (Future)
- Add Firebase Authentication (optional login)
- Implement CAPTCHA on upload form
- Add content moderation (flag inappropriate posts)
- HTTPS only (enforced by Vercel)

---

## Real-Time Updates

### How It Works
1. Client subscribes to Firestore collection: `/posts`
2. Firestore pushes updates via WebSocket (built-in)
3. React component re-renders when data changes
4. No manual polling needed

### Implementation
```typescript
// In React component
useEffect(() => {
  const unsubscribe = onSnapshot(
    collection(db, 'posts'),
    (snapshot) => {
      const posts = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      setPosts(posts);
    }
  );
  return () => unsubscribe();
}, []);
```

---

## Scaling Considerations

### MVP Load Estimates (BYU Single Campus)
- **Users:** 150-200/week
- **Posts:** 30-50/week
- **API Calls:** ~1,000/week
- **Image Storage:** ~50MB/week

**All within free tiers of:**
- Vercel: 100GB bandwidth/month
- Firestore: 50k reads/day, 20k writes/day
- Firebase Storage: 5GB storage, 1GB/day download
- Gemini API: Free tier = 1,500 requests/day

### Phase 2+ (Multi-Campus)
- **CDN:** Vercel Edge automatically scales globally
- **Database:** Firestore auto-shards (handles millions of documents)
- **API:** Serverless functions scale to demand
- **Cost Estimate (1,000 weekly active users):**
  - Vercel: $0 (hobby tier sufficient)
  - Firebase: ~$25/month
  - Gemini API: ~$10/month
  - **Total: ~$35/month** (until monetization)

---

## Development Workflow

### Local Development
```bash
# Install dependencies
npm install

# Set up environment variables
cp .env.example .env.local
# Add: GEMINI_API_KEY, FIREBASE_CONFIG

# Run dev server
npm run dev
# Open http://localhost:3000
```

### Deployment
```bash
# Push to GitHub
git push origin main

# Vercel auto-deploys to:
# https://scavenger-demo.vercel.app
```

### Environment Variables
```bash
# .env.local (gitignored)
GEMINI_API_KEY=your_key_here
NEXT_PUBLIC_FIREBASE_API_KEY=your_key_here
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=project.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=project-id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=project.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=123456
NEXT_PUBLIC_FIREBASE_APP_ID=1:123456:web:abcdef
```

---

## Monitoring & Analytics

### MVP
- **Google Analytics 4:** Page views, user flows
- **Vercel Analytics:** Performance metrics (TTFB, LCP, CLS)
- **Firebase Console:** Database usage, API quota

### Phase 2+
- Add error tracking (Sentry)
- Add custom event tracking (post creation, button clicks)
- Add user feedback widget (Hotjar or similar)

---

## Backup & Disaster Recovery

### Data Backup
- **Firestore:** Automatic daily backups by Firebase
- **Images:** Redundant storage across Firebase regions
- **Code:** Version-controlled on GitHub

### Rollback Strategy
- Revert to previous Git commit
- Vercel keeps deployment history (instant rollback)

---

## Future Architecture Enhancements

### Phase 2 (Weeks 8-16)
- Add Redis cache for frequently accessed posts
- Implement Slack bot (separate service, Firestore shared DB)
- Email parser service (Cloud Functions)

### Phase 3 (Multi-Campus)
- Add campus-specific collections: `/campuses/{campusId}/posts`
- Implement geolocation filtering
- Mobile app (React Native, reuse 90% of codebase)

---

## Technology Decisions Log

| Decision | Rationale | Alternatives Considered |
|----------|-----------|-------------------------|
| **Next.js over plain React** | SSR for SEO, API routes = no separate backend | Create React App (no SSR), Remix (overkill) |
| **Firestore over PostgreSQL** | Real-time sync built-in, simpler for MVP | Supabase (more complex), MongoDB (no real-time) |
| **Gemini over GPT-4o** | 30x cheaper, 6x faster, better OCR | GPT-4o (too expensive), Claude (no vision API) |
| **Vercel over AWS** | Zero config, free tier generous | AWS Amplify (complex), Netlify (less Next.js optimized) |
| **No auth in MVP** | Reduces friction, faster to ship | Firebase Auth (adds complexity), Clerk (overkill) |

---

**This architecture is optimized for rapid MVP iteration with minimal operational overhead. Scale decisions deferred until post-PMF validation.**
